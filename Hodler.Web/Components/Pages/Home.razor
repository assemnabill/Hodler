@page "/"
@attribute [StreamRendering(true)]
@attribute [OutputCache(Duration = 5)]
@inject HodlerApiClient HodlerApi

<PageTitle>Home</PageTitle>

<h1>Hello, Hodler!</h1>


@if (_transactionSummaryReport == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <h3>Transactions Summary Report</h3>
    <div>
    <b>Net investment: </b> @_transactionSummaryReport.NetInvestedFiat <b>€</b>
    </div>
        <b>Total Bitcoin Owned: </b> @_transactionSummaryReport.TotalBtcInvestment <b>BTC</b>
    <div>
        <b>Current Bitcoin Price: </b> @_transactionSummaryReport.CurrentBtcPrice <b>€</b>
    </div>
    <div>
        <b>Current Value: </b> @_transactionSummaryReport.CurrentValue <b>€</b>
    </div>
    <div>
        <b>Total Profit: </b> @_transactionSummaryReport.TotalProfitFiat <b>€</b>
    </div>
    <div>
        <b>Total Profit Percentage: </b> @_transactionSummaryReport.TotalProfitPercentage <b>%</b>
    </div>
    <div>
        <b>Average Bitcoin Price: </b> @_transactionSummaryReport.AverageBtcPrice <b>€</b>
    </div>
    <div>
        <b>Tax Free Total Bitcoin Owned: </b> @_transactionSummaryReport.TaxFreeTotalBtcInvestment <b>BTC</b>
    </div>
    <div>
        <b>Tax Free Profit: </b> @_transactionSummaryReport.TaxFreeProfit %
    </div>
    <div>
        @_summaryReport
    </div>
}



@code {
    private TransactionsSummaryReport? _transactionSummaryReport;
    private string _summaryReport;

    protected override async Task OnInitializedAsync()
    {
        _transactionSummaryReport = await HodlerApi.GetTransactionsSummaryReportAsync();
        _summaryReport = string.Format(
            "Net invested: {0:C}\n" +
            "Total BTC bought: {1} BTC\n" +
            "Current BTC price: {2:C}\n" +
            "Current value: {3:C}\n" +
            "Total profit: {4:C}\n" +
            "Total profit percentage: {5:0.00}%\n" +
            "Average BTC price: {6:C}\n" +
            "Net profit (tax free): {7:C}\n" +
            "Total BTC bought (tax free): {8} BTC",
            _transactionSummaryReport!.NetInvestedFiat,
            _transactionSummaryReport.TotalBtcInvestment,
            _transactionSummaryReport.CurrentBtcPrice,
            _transactionSummaryReport.CurrentValue,
            _transactionSummaryReport.TotalProfitFiat,
            _transactionSummaryReport.TotalProfitPercentage,
            _transactionSummaryReport.AverageBtcPrice,
            _transactionSummaryReport.TaxFreeProfit,
            _transactionSummaryReport.TaxFreeTotalBtcInvestment
        );
    }
}